/*!
  * vuefire v2.2.3
  * (c) 2020 Eduardo San Martin Morote
  * @license MIT
  */
/*!
  * vuefire v2.2.3
  * (c) 2020 Eduardo San Martin Morote
  * @license MIT
  */
var Vuefire=function(e){"use strict";function n(e,n){return n.split(".").reduce((function(e,n){return e[n]}),e)}function t(e,n,t){var r=(""+n).split("."),i=r.pop(),o=r.reduce((function(e,n){return e[n]}),e);return Array.isArray(o)?o.splice(Number(i),1,t):o[i]=t}function r(e){return e&&"object"==typeof e}function i(e){return e&&e.onSnapshot}function o(e,n){for(var t=0;t<e.length;t++)if(e[t][".key"]===n)return t;return-1}var s={reset:!0,serialize:function(e){var n=e.val(),t=r(n)?n:Object.defineProperty({},".value",{value:n});return Object.defineProperty(t,".key",{value:e.key}),t},wait:!1};function a(e,n,t){var o=[{},{}],s=Object.keys(t).reduce((function(e,n){var r=t[n];return e[r.path]=r.data(),e}),{});return function e(n,t,o,a){t=t||{};var f=a[0],c=a[1];for(var u in Object.getOwnPropertyNames(n).forEach((function(e){var t=Object.getOwnPropertyDescriptor(n,e);t&&!t.enumerable&&Object.defineProperty(f,e,t)})),n){var l=n[u];if(null==l||l instanceof Date||l.toDate||l.longitude&&l.latitude)f[u]=l;else if(i(l))f[u]="object"==typeof t&&u in t?t[u]:l.path,c[o+u]=l;else if(Array.isArray(l)){f[u]=Array(l.length);for(var d=0;d<l.length;d++){var v=l[d];v&&v.path in s&&(f[u][d]=s[v.path])}e(l,t[u]||f[u],o+u+".",[f[u],c])}else r(l)?(f[u]={},e(l,t[u],o+u+".",[f[u],c])):f[u]=l}}(e,n,"",o),o}var f={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data()||{},"id",{value:e.id})},wait:!1};function c(e){for(var n in e)e[n].unsub()}function u(e,t,r,i,o,s,f,c){var u=a(e.serialize(i),n(t,r),o),l=u[0],v=u[1];s.set(t,r,l),d(e,t,r,o,v,s,f,c)}function l(e,n){var t=e.ref,r=e.target,i=e.path,o=e.depth,s=e.resolve,a=e.ops,f=Object.create(null),l=t.onSnapshot((function(e){e.exists?u(n,r,i,e,f,a,o,s):(a.set(r,i,null),s())}));return function(){l(),c(f)}}function d(e,t,r,i,o,s,a,f){var c=Object.keys(o);if(Object.keys(i).filter((function(e){return c.indexOf(e)<0})).forEach((function(e){i[e].unsub(),delete i[e]})),!c.length||++a>e.maxRefDepth)return f(r);var u=0,d=c.length,v=Object.create(null);function b(e){e in v&&++u>=d&&f(r)}c.forEach((function(f){var c=i[f],u=o[f],d=r+"."+f;if(v[d]=!0,c){if(c.path===u.path)return;c.unsub()}i[f]={data:function(){return n(t,d)},unsub:l({ref:u,target:t,path:d,depth:a,ops:s,resolve:b.bind(null,d)},e),path:u.path}}))}var v={set:function(e,n,r){return t(e,n,r)},add:function(e,n,t){return e.splice(n,0,t)},remove:function(e,n){return e.splice(n,1)}};function b(e,n,t,r){return new Promise((function(i,a){var f;f=Array.isArray(e[n])?function(e,n){var t=e.vm,r=e.key,i=e.collection,a=e.resolve,f=e.reject,c=e.ops;void 0===n&&(n=s);var u=Object.assign({},s,n),l=u.wait?[]:c.set(t,r,[]),d=i.on("child_added",(function(e,n){var t=n?o(l,n)+1:0;c.add(l,t,u.serialize(e))}),f),v=i.on("child_removed",(function(e){c.remove(l,o(l,e.key))}),f),b=i.on("child_changed",(function(e){c.set(l,o(l,e.key),u.serialize(e))}),f),h=i.on("child_moved",(function(e,n){var t=o(l,e.key),r=c.remove(l,t)[0],i=n?o(l,n)+1:0;c.add(l,i,r)}),f);return i.once("value",(function(e){u.wait&&c.set(t,r,l),a(e)})),function(e){if(i.off("child_added",d),i.off("child_changed",b),i.off("child_removed",v),i.off("child_moved",h),!1!==e){var n="function"==typeof e?e():[];c.set(t,r,n)}}}({vm:e,key:n,collection:t,resolve:i,reject:a,ops:v},r):function(e,n){var t=e.vm,r=e.key,i=e.document,o=e.resolve,a=e.reject,f=e.ops;void 0===n&&(n=s);var c=Object.assign({},s,n),u=i.on("value",(function(e){f.set(t,r,c.serialize(e))}),a);return i.once("value",o),function(e){if(i.off("value",u),!1!==e){var n="function"==typeof e?e():null;f.set(t,r,n)}}}({vm:e,key:n,document:t,resolve:i,reject:a,ops:v},r),e._firebaseUnbinds[n]=f}))}var h={bindName:"$rtdbBind",unbindName:"$rtdbUnbind",serialize:s.serialize,reset:s.reset,wait:s.wait},p={set:function(e,n,r){return t(e,n,r)},add:function(e,n,t){return e.splice(n,0,t)},remove:function(e,n){return e.splice(n,1)}};function y(e,t,r,i,o){return new Promise((function(s,l){var v;v="where"in r?function(e,n){var t=e.vm,r=e.key,i=e.collection,o=e.ops,s=e.resolve,u=e.reject;void 0===n&&(n=f);var l,v=Object.assign({},f,n),b=v.wait?[]:o.set(t,r,[]),h=s,p=[],y={added:function(e){var n=e.newIndex,t=e.doc;p.splice(n,0,Object.create(null));var r=p[n],i=a(v.serialize(t),void 0,r),f=i[0],c=i[1];o.add(b,n,f),d(v,b,n,r,c,o,0,s.bind(null,t))},modified:function(e){var n=e.oldIndex,t=e.newIndex,r=e.doc,i=p[n],f=b[n],c=a(v.serialize(r),f,i),u=c[0],l=c[1];p.splice(t,0,i),o.remove(b,n),o.add(b,t,u),d(v,b,t,i,l,o,0,s)},removed:function(e){var n=e.oldIndex;o.remove(b,n),c(p.splice(n,1)[0])}},m=i.onSnapshot((function(e){var n="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!l&&n.length){l=!0;for(var i=0,a=n.length,f=Object.create(null),c=0;c<a;c++)f[n[c].doc.id]=!0;s=function(e){e.id in f&&++i>=a&&(v.wait&&o.set(t,r,b),h(t[r]),s=function(){})}}n.forEach((function(e){y[e.type](e)})),n.length||(v.wait&&o.set(t,r,b),s(b))}),u);return function(e){if(m(),!1!==e){var n="function"==typeof e?e():[];o.set(t,r,n)}p.forEach(c)}}({vm:e,key:t,ops:i,collection:r,resolve:s,reject:l},o):function(e,t){var r=e.vm,i=e.key,o=e.document,s=e.resolve,a=e.reject,l=e.ops;void 0===t&&(t=f);var d,v,b,h=Object.assign({},f,t),p=Object.create(null);d=s,v=function(){return n(r,i)},b=!1,s=function(){if(!b)return b=!0,d(v())};var y=o.onSnapshot((function(e){e.exists?u(h,r,i,e,p,l,0,s):(l.set(r,i,null),s(null))}),a);return function(e){if(y(),!1!==e){var n="function"==typeof e?e():null;l.set(r,i,n)}c(p)}}({vm:e,key:t,ops:i,document:r,resolve:s,reject:l},o),e._firestoreUnbinds[t]=v}))}var m={bindName:"$bind",unbindName:"$unbind",serialize:f.serialize,reset:f.reset,wait:f.wait};return e.firestorePlugin=function(e,n){void 0===n&&(n=m);var t=e.config.optionMergeStrategies;t.firestore=t.provide;var r=Object.assign({},m,n),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,n){this._firestoreUnbinds[e](n),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]},e.prototype[i]=function(e,n,t){var i=Object.assign({},r,t);this._firestoreUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=y(this,e,n,p,i);return this.$firestoreRefs[e]=n,s},e.mixin({beforeCreate:function(){this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null)},created:function(){var e=this.$options.firestore,n="function"==typeof e?e.call(this):e;if(n)for(var t in n)this[i](t,n[t],r)},beforeDestroy:function(){for(var e in this._firestoreUnbinds)this._firestoreUnbinds[e]();this._firestoreUnbinds=null,this.$firestoreRefs=null}})},e.rtdbPlugin=function(e,n){void 0===n&&(n=h);var t=e.config.optionMergeStrategies;t.firebase=t.provide;var r=Object.assign({},h,n),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,n){!function(e,n,t){e._firebaseUnbinds[n](t),delete e._firebaseSources[n],delete e._firebaseUnbinds[n]}(this,e,n)},e.prototype[i]=function(e,n,t){var i=Object.assign({},r,t);this._firebaseUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=b(this,e,n,i);return this._firebaseSources[e]=n,this.$firebaseRefs[e]=n.ref,s},e.mixin({beforeCreate:function(){this.$firebaseRefs=Object.create(null),this._firebaseSources=Object.create(null),this._firebaseUnbinds=Object.create(null)},created:function(){var e=this.$options.firebase;if("function"==typeof e&&(e=e.call(this)),e)for(var n in e)this[i](n,e[n],r)},beforeDestroy:function(){for(var e in this._firebaseUnbinds)this._firebaseUnbinds[e]();this._firebaseSources=null,this._firebaseUnbinds=null,this.$firebaseRefs=null}})},e}({});
